---
order: 9
---



#  09.时间网页及音视频控件2



## 音频和视频的播放与录制

PySide6 提供音频和视频的播放和录制功能,与音频、视频播放和录制功能相关的类在PySide6.QtMultimedia模块中,

用于显示视频内容的控件在 PySide6.QtMultimediaWidgets模块中。

本章主要介绍音频和视频的播放与录制及摄像头拍照方面的内容。

#### 播放音频和视频

##### 播放器QMediaPlayer

播放器 QMediaPlayer 可以播放音频和视频,它可以直接播放的格式有限。

要播放更多格式的音频或视频,例如 mp4 格式的视频文件,需要在本机上安装解码器。

这里推荐种解码器 K-Lite Codec Pack,它可以对绝大多数影音格式进行解码,安装它之后QMediaPlayer 可以播放绝大多数的音频和视频文件。

在搜索引警中搜索"K-Lite"就可以下载 K-Lite Codec Pack 解码器,或者到官网下载。K-Lite Codec Pack 是完全免费的下载后使用默认设置安装即可。

QMediaPlayer 继承自QObject,用QMediaPlayer 定义播放器实例对象的方法如下所示,其中 parent 是继承自QObject 类的实例对象

```python
from PySide6.QtMultimedia import QMediaPlayer

QMediaPlayer(parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
```

###### 播放器 QMediaPlayer 的常用方法

QMediaPlayer 的常用方法如表所示,要方法介绍如下:

- 要播放音频或视频,首先需要给 QMediaPlayer 设置媒体源。
  - 可以用setSource(source: Union[QUrl,str])方法或用setSourceDevice(device: QIODevice,sourceUrl:Union[QUrl,str]=Default(QUrl))方法设置媒体文件,其中 sourceUrl是可选参数,用于取额外的信息;
  - 用source()和 sourceDevice()分别获取媒体源QUrl和QIODevice,有关 QUrl和 QIODevice 的介绍见参数/辅助类章节的内容

- 要显示视频,需要将 QMediaPlayer 与显示视频的控件关联
  - 可以显示视频的控件有QVideoWidget、QGraphicsVideoltem,关联方法分别是 setVideoOutput(QVideoWidget)和 setVideo(utput(QGraphicsVideoltem)
  - 要播放音频,需要用setAudioOutput(output: QAudioOutput)方法设置音频输出设备,有关QAudioOutput 的介绍见下面的内容。
- 用play()方法开始播放音频或视频,用pause()方法暂停播放,用stop()方法停止播放并返回。
- 若isSeekable()返回值是True
  - 可以用setPosition(position:int)方法设置当前播放的时间
  - 用position()方法获取当前播放的时间
  - 用duration()方法获取音频或视频的总时间,参数或返回值的单位是毫秒。
- 用setPlaybackRate(rate:float)方法设置播放速率,参数为10表示正常播放;参数 rate可以为负值,表示回放速率。有些多媒体不支持回放。
- 用setLoops(loops;int)方法设置循环播放次数参数loops 可取:
  - QMediaPlayer.Infinite(无限次)
  - QMediaPlayer.Once(一次或其他整数)
- 用state()方法获取播放状态,QMediaPlayer.State,返回值可能是
  - QMediaPlayer.StoppedState
  - QMediaPlayer.PlayingState 
  - QMediaPlayer.PausedState
- 用playbackState()方法获取播放器的播放状态QMediaPlayer.PlaybackState,返回值可能是:
  - QMediaPlayer.StoppedState 
  - QMediaPlayer.PlayingState 
  - QMediaPlayer.PausedState
- 用mediaStatus()方法获取播放器所处的状态QMediaPlayer.MediaStatus,返回值可能是:
  - QMediaPlayer.NoMedia
  - QMediaPlayer.LoadingMedia
  - QMediaPlayer.LoadedMedia
  - QMediaPlayer.StalledMedia
  - QMediaPlayer.BufferingMledia
  - QMediaPlayer.BufferedMedia
  - QMediaPlayer.EndOfMedia
  - QMediaPlayer.InvalidMedia。
- 用error()方法获取播放器出错信息QMediaPlayer.Error,返回值可能是:
  - QMediaPlayer.NoError
  - QMediaPlayer.ResourceError
  - QMediaPlayer.FormatError
  - QMediaPlayer.NetworkError
  - QMediaPlayer.AccessDeniedError

| QMediaPlayer的方法及参数类型                                 | 说 明                                  |
| ------------------------------------------------------------ | -------------------------------------- |
| [slot]setSource(source:Union[QUrl,str])                      | 设置要播放的音频或视频源               |
| source()                                                     | 获取音频或视频地址QUrl                 |
| [slot]setSourceDevice(device:QlODevice, sourceUrl: Union[QUrl,str]=Default(QUrl)) | 设置音频或视频源                       |
| sourceDevice()                                               | 获取音频或视频源QIODevice              |
| setActiveAudioTrack(index:int)                               | 设置当前的声道                         |
| activeAudioTrack()                                           | 获取当前的声道                         |
| setActiveVideoTrack(index:int)                               | 设置当前的视频轨道                     |
| activeVideoTrack()                                           | 获取当前的视频轨道                     |
| setActiveSubtitleTrack(index:int)                            | 设置当前的子标题轨道                   |
| activeSubtitleTrack()                                        | 获取当前的子标题轨道                   |
| [slot]setPlaybackRate(rate:float)                            | 设置播放速                             |
| playbackRate()                                               | 获取播放速率                           |
| isSeekable()                                                 | 获取是否可以定位到某一播放时间         |
| [slot]setPosition(position:int)                              | 设置播放时间(毫秒)                     |
| position()                                                   | 获取当前的播放时间(毫秒)               |
| setAudioOutput(output:QAudioOutput)                          | 设置播放音频的设备                     |
| setVideoOutput(QVideoWidget)                                 | 设置显示视频的控件                     |
| setVideoOutput(QGraphicsVideoItem)                           | 设置显示视频的图项                     |
| setLoops(loops:int)                                          | 设置循环播放次数                       |
| loops()                                                      | 获取循环播放次数                       |
| duration()                                                   | 获取音频或视频可以播放的总时间(毫秒)   |
| isAvailable()                                                | 获取平台是否支持该播放器               |
| playbackState()                                              | 获取播放状态QMediaPlayer.PlaybackState |
| mediaStatus()                                                | 获取播放器所处的状态                   |
| error()                                                      | 获取出错原因 QMediaPlayer.Error        |
| errorString()                                                | 获取出错信息                           |
| hasAudio()、hasVideo()                                       | 获取多媒体中是否有音频或视频           |
| bufferProgress()                                             | 获取缓冲百分比,100%时才可以播放        |
| [slot]play()                                                 | 播放音频或视频                         |
| [slot]pause()                                                | 暂停播放                               |
| [slot]stop()                                                 | 停止播放并返回                         |



###### 播放器QMediaPlayer 的信号

播放器QMediaPlayer 的信号如表所示

| QMediaPlayer的信号及参数类型                            | 说明                               |
| ------------------------------------------------------- | ---------------------------------- |
| activeTracksChanged()                                   | 当前轨道发生改变时发送信号         |
| audioOutputChanged()                                    | 音频输出设备发生改变时发送信号     |
| bufferProgressChanged(float)                            | 缓冲进度发生改变时发送信号         |
| durationChanged(int)                                    | 播放总时间发生改变时发送信号       |
| errorChanged()                                          | 出错信息发生改变时发送信号         |
| errorOccurred(error:QMediaPlayer.Error,errorString:str) | 播放出错时发送信号                 |
| hasAudioChanged(bool)                                   | 可播放音频的状态发生改变时发送信号 |
| hasVideoChanged(bool)                                   | 可播放视频的状态发生改变时发送信号 |
| loopsChanged()                                          | 播放次数发生改变时发送信号         |
| MediaStatusChanged(QMediaPlayer.MediaStatus)            | 播放器所处的状态发生改变时发送信号 |
| playbackRateChanged(float)                              | 播放速度发生改变时发送信号         |
| P]aybackStateChanged(QMediaPlayer.PlaybackState)        | 播放状态发生改变时发送信号         |
| positionChanged(int)                                    | 播放位置发生改变时发送信号         |
| scekableChanged(bool)                                   | 可定位播放状态发生改变时发送信号   |
| sourceChanged(QUrl)                                     | 音频或视频源发生改变时发送信号     |
| tracksChanged()                                         | 轨道发生改变时发送信号             |
| videoOutputChanged()                                    | 关联的视频播放器发生改变时发送信号 |

##### 音频输出和视频输出

播放器QMediaPlayer 需要关联音频输出设备和视频输出控件才能播放音频和视频音频输出.

- 音频输出QAudioOutput:需要定义 QAudioOutput 的实例,QAudioOutput 用于连接 QMediaPlayer与音频输出设备；QAudioOutput 继承自QObject

- 视频控件 QVideoWidget :视频输出需要用到视频控件 QVideoWidget；QVideoWidget 继承自QWidget
- 视频图项 QGraphicsVideoItem:QGraphicsVideoItem 作为图项应用于场景中；QGraphicsVideoltem 继承自QGraphicsObject。

用QAudioOutput、QVideoWidget 和 QGraphicsVideoItem 创建实例对象的方法如下所示,其中QAudioDevice 是本机上的音频输入输出设备。

```python
from PySide6.QtMultimedia import QAudioOutput
from PySide6.QtMultimediaWidgets import QVideoWidget, QGraphicsVideoItem

QAudioOutput(device: PySide6.QtMultimedia.QAudioDevice, parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
QAudioOutput(parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None

QVideoWidget(parent: Union[PySide6.QtWidgets.QWidget, NoneType]= None) -> None

QGraphicsVideoItem(parent: Union[PySide6.QtWidgets.QGraphicsItem, NoneType]= None) -> None
```

###### QAudioOutput、QVideoWidget 和 QGraphicsVideoItem 的常用方法

- 用setAspectRatioMode(mode:Qt.AspectRatioMode)方法设置视频控件所播放视频的长宽比模式,参数 mode 可取: 
  - Qt.IgnoreAspectRatio(不保持比例关系)
  - Qt.KeepAspectRatio(保持原比例关系)
  - Qt.KeepAspectRatioByExpanding(通过扩充保持原比例关系)





音频输出**QAudioOutput**

| 方法及参数类型                        | 说明                        |
| ------------------------------------- | --------------------------- |
| [slot]setVolume(volume:float)         | 设置音量,参数取值范围为 0~1 |
| volume()                              | 获取音量                    |
| [slot]setMuted(muted:bool)            | 设置是否静音                |
| isMuted()                             | 获取是否静音                |
| [slot]setDevice(device: QAudioDevice) | 设置音频设备                |
| device()                              | 获取音频设备                |

视频控件 **QVideoWidget**

| [slot]setAspectRatioMode(mode:Qt.AspectRatioMode) | 设置长宽比模式   |
| ------------------------------------------------- | ---------------- |
| aspectRatioMode()                                 | 获取长宽比模式   |
| [slot]setFullScreen(fullScreen:bool)              | 设置全屏显示     |
| isFullScreen()                                    | 获取是否全屏显示 |

视频图项 **QGraphicsVideoItem**

| boundingRect()                               | 获取边界矩形QRectF |
| -------------------------------------------- | ------------------ |
| setAspectRatioMode(mode: Qt.AspectRatioMode) | 设置长宽比模式     |
| aspectRatioMode()                            | 获取长宽比模式     |
| setOffset(offset:Union[QPointF,QPoint])      | 设置偏移量         |
| offset()                                     | 获取偏移量QPointF  |
| setSize(size: Union[QSizeF,QSize])           | 设置尺寸           |
| size()                                       | 获取尺寸 QSizeF    |

###### QAudioOutputQVideoWidget 和 QGraphicsVideoItem 的信号

QAudioOutput、QVideoWidget 和 QGraphicsVideoItem 的信号如表所示

| 类                   | 信号及参数类型                     | 说明                         |
| -------------------- | ---------------------------------- | ---------------------------- |
| QAudioOutput         | deviceChanged()                    | 音频设备发生改变时发送信号   |
| QAudioOutput         | mutedChanged(muted: bool)          | 静音状态发生改变时发送信号   |
| QAudioOutput         | volumeChanged(volume: float)       | 音量发生改变时发送信号       |
| QVideoWidget         | aspectRatioModeChanged(mode)       | 长宽比模式发生改变时发送信号 |
| QVideoWidget         | fullScreenChanged(fullScreen:bool) | 全屏状态发生改变时发送信号   |
| QGraphics Videoltenm | nativeSizeChanged(size: QSizeF)    | 尺寸发生改变时发送信号       |



##### 音频播放 QSoundEffect

QSoundEffect 用于播放低延迟无压缩音频文件,如wav 文件,并可呈现一些特殊效果

用QSoundEffect 创建音频播放实例对象的方法如下所示其中 parent 是继承自 QObject的实例对象,QAudioDevice 是机器上音频设备。

```python
from PySide6.QtMultimedia import QSoundEffect

QSoundEffect(audioDevice: PySide6.QtMultimedia.QAudioDevice, parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
QSoundEffect(parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None 
```

###### QSoundEffect的常用方法

QSoundEffect 的常用方法如表所示,主要方法介绍如下

- 用setSource(url:Union[QUrl,str])方法设置音频源,参数 QUrl可以是指向网络的文件,也可以是本机文件;
  - 用source()方法获取音频源 QUrl。
- 用setLoopCount(int)方法设置播放次数,如为0或1只播放一次,如果取QSoundEffect.Infinite 则无限次播放;
  - 用lopCount()方法获取播放次数;
  - 用loopsRemaining)方法获取剩余播放次数。
- 用play()方法开始播放
- 用stop()方法停止播放。
  - 用status()方法获取当前的播放状态;返回值是枚举类型 QSoundEffect.Status.可取值有 :
    - QSoundEffectNull
    - QSoundEffect.Loading
    - QSoundEffect.Ready
    - QSoundEffect.Error

| QSoundEflect的方法及参数类型        | 返回值的类型        | 说明                 |
| ----------------------------------- | ------------------- | -------------------- |
| setSource(url: Union[QUrl,str])     | None                | 设置音频源           |
| source()                            | QUrI                | 获取音频源           |
| setAudioDevice(device:QAudioDevice) | None                | 设置音频设备         |
| audioDevice()                       | QAudioDevice        | 获取音频设备         |
| setLoopCount(loopCount; int)        | None                | 设置播放次数         |
| loopCount()                         | int                 | 获取播放次数         |
| loopsRemaining()                    | int                 | 获取剩余的播放次数   |
| setMuted(muted:bool)                | None                | 设置静音             |
| isMuted()                           | bool                | 获取是否是静音       |
| setVolume(,volume:float)            | None                | 设置音量             |
| volume()                            | float               | 获取音量             |
| [slot]play()                        | None                | 开始播放             |
| isPlaying()                         | bo0l                | 获取是否正在播放     |
| [slot]stop()                        | None                | 停止播放             |
| isLoaded()                          | bool                | 获取是否已经加载声源 |
| status()                            | QSoundEffect.Status | 获取播放状态         |
| [static]supportedMimeTypes()        | :List[str]          | 获取支持的mime类型   |

###### QSoundEffect 的信号

QSoundEffect 的信号如表所示

| QSoundEffect的信号及参数类型 | 说明                           |
| ---------------------------- | ------------------------------ |
| audioDeviceChanged()         | 音频设备发生改变时发送信号     |
| loadedChanged()              | 加载状态发生改变时发送信号     |
| loopCountChanged()           | 循环次数发生改变时发送信号     |
| loopsRemainingChanged()      | 剩余循环次数发生改变时发送信号 |
| mutedChanged()               | 静音状态发生改变时发送信号     |
| playingChanged()             | 播放状态发生改变时发送信号     |
| sourceChanged()              | 音频源发生改变时发送信号       |
| statusChanged()              | 状态发生改变时发送信号         |
| volumeChanged()              | 音量发生改变时发送信号         |



##### 动画播放 QMovie

QMovie用于播放无声音的静态动画,例如 gif文件它在 PySide6Gui模块中,需要用QLabel的 setMovie(QMovie)方法与 QLabel 相关联来播放动画。

用QMovie类创建播放动画的实例对象的方法如下,其中 parent 是继承自QObiect的实例对象

可以用文件名或指向图形动画的 QIODevice 设备来指定动画源;

format 指定动画来源的格式取值类型是QByteArray或bytes,例如 bgif'b'webp'如果不指定格式系统会自行选择合适的格式

```python
from PySide6.QtGui import QMovie

QMovie(device: PySide6.QtCore.QIODevice, format: Union[PySide6.QtCore.QByteArray, bytes]= Default(QByteArray), parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
QMovie(fileName: str, format: Union[PySide6.QtCore.QByteArray, bytes]= Default(QByteArray), parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
QMovie(parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
```

###### QMovie的常用方法

QMovie 的常用方法如表所示,主要方法介绍如下

- 用setFileName(fileName;str)或 setDevice(device:QIODevice)方法设置动画源;
  - 用isValid()方法获取动画源是否有效。
- 用setFormat(format;Union[QByteArray,bytes])方法设置动画源的格式,例如setFormat(b'gif')。
- 用start()方法开始播放动画
  - 用stop()方法停止播放
  - 用pause(True)方法暂停播放；用pause(False)方法继续播放;
- 用setSpeed(percentSpeed;int)方法设置播放速度,参数是正常播放速度的百分比值,例如 setSpeed(200)表示播放速度是原播放速度的2倍。
- 用setCacheMode(QMovieCacheMode)方法设置播放时是否进行缓存参数可以取QMovie.CacheNone或 QMovie.CacheAll.
- 用jumpToFrame(int)方法可以跳转到指定的帧;
  - 用jumpToNextFrame()方法跳转到下一帧;
  - 当跳转到所需要的帧后,用currentImage()方法或currentPixmap()方法可以获取帧的图像

- 用state()方法可以获得当前的播放状态,播放状态有:
  - QMovie.NoRunning
  - QMovie,Paused 
  - QMove.Running
- 用lastErrorString()方法取最近出错的信息,该信息可读;
  - 用lastError()方法获取出错信息,返回值是QImageReader.ImageReaderError 的枚举值可取以下值,分别对应值0~4:
    - QImageReader.UnknownError
    - QlmageReader.FileNotFoundError 
    - QlmageReader.DeviceError
    - QImageReader.UnsupportedFormatError 
    - QImageReader.InvalidDataError

| setFileName(fileName: str)                           | 设置动画文件                   |
| ---------------------------------------------------- | ------------------------------ |
| fileName()                                           | 获取动画文件名                 |
| setDevice(device: QIODevice)                         | 设置设备                       |
| device()                                             | 获取设备QIODevice              |
| setFormat(format: Union[QByteArray,bytes])           | 设置动画格式                   |
| format()                                             | 获取动画格式QByteArray         |
| [static]supportedFormats()                           | 获取支持的格式List[QByteArray] |
| setScaledSize(QSize)                                 | 设置尺寸                       |
| [slot]setSpeed(percentSpeed: int)                    | 设置相对正常播放速度的百分比   |
| speed()                                              | 获取正常播放速度的百分比       |
| setCacheMode(QMovie.CacheMode)                       | 设置缓冲模式                   |
| setBackgroundColor(Union[QColor,Qt.GlobalColor,str]) | 设置背景色                     |
| backgroundColor()                                    | 获取背景色QColor               |
| [slot]start()                                        | 开始播放动画                   |
| [slot]stop()                                         | 停止播放动画                   |
| [slot]setPaused(paused, bool)                        | 暂停或继续播放动画             |
| state()                                              | 获取播放状态QMovie.MovieState  |
| currentFrameNumber()                                 | 获取当前帧                     |

###### QMovie的信号

QMovie的信号如表所示

| QMovie的方法及参数类型  | 说 明                          |
| ----------------------- | ------------------------------ |
| currentImage()          | 获取当前帧的图像QImage         |
| currentPixmap()         | 获取当前帧的图像 QPixmap       |
| frameCount()            | 获取总帧数                     |
| frameRect()             | 获取尺寸QRect                  |
| isValid()               | 获取动画源是否有效             |
| jumpToFrame(int)        | 跳转到指定的帧,成功则返回True  |
| [slot]jumpToNextFrame() | 跳转到下一帧,成功则返回True    |
| lastErrorString()       | 获取最近的出错信息             |
| lastError()             | 获取出错信息                   |
| loopCount()             | 获取循环播放次数               |
| nextFrameDelay()        | 获取播放下一帧的等待时间(毫秒) |



###### QMovie的应用实例

运行下面的程序,通过双击窗口,打开动画文件并播放动画

```python
# -*- coding: UTF-8 -*-
# File date: Hi_2023/3/4 0:54
# File_name: 01-QMovie的应用实例.py

from PySide6.QtWidgets import QApplication, QHBoxLayout, QFileDialog, QWidget, QLabel
from PySide6.QtCore import Qt
import sys
from PySide6.QtGui import QMovie


class MyLabel(QLabel):
    def __init__(self, parent=None):
        super().__init__(parent)

    def mouseDoubleClickEvent(self, event):
        filename, fil = QFileDialog.getOpenFileName(self,
                                                    caption="选择动画文件",
                                                    dir="../../../../Resources/images",
                                                    filter="动画文件(*.gif *.webp);;所有文件(*.*)")
        movie = QMovie(filename)
        movie.setBackgroundColor(Qt.GlobalColor.gray)
        if movie.isValid():
            self.setMovie(movie)
            movie.start()


class MyWindow(QWidget):
    def __init__(self, parent=None):
        super().__init__(parent)

        self.resize(800, 600)
        self.setupUi()

    def setupUi(self):
        self.label = MyLabel()
        self.label.setText("双击我,打开动画文件播放动画!")
        self.label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        H = QHBoxLayout(self)
        H.addWidget(self.label)


if __name__ == '__main__':
    app = QApplication(sys.argv)
    win = MyWindow()

    win.show()
    sys.exit(app.exec())

```





#### 录制音频和视频及拍照

##### 多媒体设备QMediaDevices

多媒体设备是指本机中的音频输入设备(如麦克风),音频输出设备(如音箱、头戴耳机)和视频输入设备(如摄像头)。

多媒体设备通过 QMediaDevices 类提供的方法来获取

- 音频输人输出设备类QAudioDevice
- 视频输入设备类QCameraDevice

用QMediaDevices QAudioDevice和QCameraDevice 创建设备实例的方法如下所示。

```python
from PySide6.QtMultimedia import QMediaDevices, QAudioDevice, QCameraDevice

QMediaDevices(parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None

QAudioDevice(self) -> None
QAudioDevice(other: PySide6.QtMultimedia.QAudioDevice) -> None

QCameraDevice(self) -> None
QCameraDevice(other: PySide6.QtMultimedia.QCameraDevice) -> None
```

###### QMediaDevices QAudioDevice和QCameraDevice 的常用方法

QMediaDevices QAudioDevice和QCameraDevice 的常用方法分别如表所示

主要是先用QMediaDevices 提供的静态方法获取本机上的音频设备和视频输人设备,然后用QAudioDevice  QCameraDevice 提供的方法分别获取音频设备和视频输人设备的详细信息。

多媒体设备**QMediaDevices**

| QMediaDevices的方法          | 返回值的类型        | 说明                   |
| ---------------------------- | ------------------- | ---------------------- |
| [static]audioInputs()        | List[QAudioDeviceJ  | 获取音频输入设备       |
| [static]defaultAudioInput()  | QAudioDevice        | 获取默认的音频输入设备 |
| [static]audio()utputs()      | ListCQAudioDevice]  | 获取音频输出设备       |
| [static]defaultAudioOutput() | QAudioDevice        | 获取默认的音频输出设备 |
| [static]videoInputs()        | List[QCameraDevice] | 获取视频输人设备       |
| [static]defaultVideoInput()  | QCameraDevice       | 获取默认的视频输人设备 |

音频输人输出设备类**QAudioDevice**

| QAudioDevice的方法              | 返回值的类型                    | 说 明                                                        |
| ------------------------------- | ------------------------------- | ------------------------------------------------------------ |
| description()                   | Str                             | 获取音频设备的信息                                           |
| id()                            | QByteArray                      | 获取音频设备的识别号                                         |
| isDefault()                     | bool                            | 获取是否是默认的音频设备                                     |
| isFormatSupported(QAudioFormat) | bool                            | 获取音频设备是否支持某种音频格式                             |
| isNull()                        | bool                            | 获取设备是否有效                                             |
| maximumChannelCount()           | int                             | 获取音频设备支持的最大通道数                                 |
| minimumChannelCount()           | int                             | 获取音频设备支持的最小通道数                                 |
| maximumSampleRate()             | int                             | 获取音频设备支持的最大采样率(Hz)                             |
| minimumSampleRate()             | int                             | 获取音频设备支持的最小采样率(Hz)                             |
| mode()                          | QAudioDevice.Mode               | 获取音频设备是输入还是输出设备,返回值可取 <br />QAudioDevice.Null(无效设备)<br />QAudioDevice.Input(输人设备)<br />QAudioDevice.Output(输出 设备) |
| preferredFormat()               | QAudioFormat                    | 获取音频设备的默认音频格式                                   |
| supportedSampleFormats()        | List[QAudioFormat.SampleFormat] | 获取音频设备支持的采样格式,格式有<br />QAudioFormat.UInt8<br />QAudioFormat.Intl6<br />QAudioFormat.Int32<br />QAudioFormat.Float<br />QAudioFormat.Unknown |

视频输入设备类**QCameraDevice**

| QCameraDevice的方法 | 返回值的类型            | 说明                                                         |
| ------------------- | ----------------------- | ------------------------------------------------------------ |
| description()       | Str                     | 获取视频输入设备的信息                                       |
| id()                | QByteArray              | 获取视频输入设备的识别号                                     |
| isDefault()         | bool                    | 获取是否是默认的视频输入设备                                 |
| isNull()            | bool                    | 获取视频输入设备是否有效                                     |
| photoResolutions()  | List[QSize]             | 获取视频输入设备的分辨率                                     |
| position()          | QCameraDevice, Position | 获取视频输入设备的位置,返回值可取 QCarmeraDevice.BackFace(后置摄像头)、QCameraDevice.FrontFace(前置摄像头)或 QCameraDevice.UnspecifiedPosition(位 置不确定) |
| videoFormats()      | List[QCameraFormat]     | 获取视频输入设备支持的格式                                   |

###### 信号

QMediaDevices的信号有

| 信号                  | 说明                               |
| --------------------- | ---------------------------------- |
| audioInputsChanged()  | 当音频输入设备发生改变时发送信号。 |
| audioOutputsChanged() | 音频输出设备发生改变时发送信号。   |
| videoInputsChanged()  | 视频输入设备发生改变时发送信号。   |





##### 音频接口QAudioInput 和视频接口QCamera

要录制音频和视频,需要定义音频设备的接口 QAudioInput 和视频设备的接口QCamera后,才能调用音频设备和视频设备进行录制

QAudioInput 和 QCamera 相当于音频和视频输人通道。

- QAudioInput 是机器上的音频输人,例如内置麦克风或头戴麦克风
- QCamera 是机器上的摄像头或外接相机。

利用QAudiolnput 和 QCamera 创建音频设备和视频设备接口的方法如下所示。

```python
from PySide6.QtMultimedia import QAudioInput, QCamera

QAudioInput(deviceInfo: PySide6.QtMultimedia.QAudioDevice, parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
QAudioInput(parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None

QCamera(cameraDevice: PySide6.QtMultimedia.QCameraDevice, parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
QCamera(parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
QCamera(position: PySide6.QtMultimedia.QCameraDevice.Position, parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
```

###### 音频接口QAudioInput的常用方法

音频接口 QAudioInput 的常用方法如表所示,主要方法:

- 用setDevice(device:QAudioDevice)方法设置音频设备;
- 用setMuted(muted:bool)方法设置静音;
- 用setVolume(volume:float)方法设置音量,音量参数 volume 的取值范围是0~1。

| QAudioInput的方法及参数类型    | 返回值的类型 | 说明         |
| ------------------------------ | ------------ | ------------ |
| setDevice(device:QAudioDevice) | None         | 设置音频设备 |
| device()                       | QAudioDevice | 获取音频设备 |
| setMuted(muted:bool)           | None         | 设置是否静音 |
| isMuted()                      | bool         | 获取是否静音 |
| setVolume(volume: float)       | None         | 设置音量     |
| volume()                       | float        | 获取音量     |

###### 音频接口QAudioInput的信号

| 信号                         | 方法                         |
| ---------------------------- | ---------------------------- |
| deviceChanged()              | 当设备发生改变时发送信号。   |
| mutedChanged(muted:bool)     | 静音状态发生改变时发送信号。 |
| volumeChanged(volume: float) | 音量发生改变时发送信号。     |

###### 视频接口 QCamera的常用方法

视频接口 QCamera 的常用方法如表所示,主要方法介绍如下

| QCamera的方法及参数类型                                   | 返回值的类型             | 说 明                                     |
| --------------------------------------------------------- | ------------------------ | ----------------------------------------- |
| setCameraDevice(cameraDevice: QCameraDevice)              | None                     | 设置视频设备                              |
| cameraDevice()                                            | QCameraDevice            | 获取视频设备                              |
| [slot]start()                                             | None                     | 开启相机                                  |
| [slot]stop()                                              | None                     | 关闭相机                                  |
| [slot]setActive(active: bool)                             | None                     | 设置是否打开视频设备                      |
| isActive()                                                | bool                     | 获取相机是否启用                          |
| isAveilsble()                                             | bool                     | 获取相机是否可用                          |
| setCameraFormat(format: QCameraFormat)                    | None                     | 设置视频格式                              |
| cameraFormat()                                            | QCameraFormat            | 获取视频格式                              |
| captureSession()                                          | QMediaCaptureSession     | 获取与 QCamera关联的媒体捕 获器           |
| supportedFeatures()                                       | QCamera.Features         | 获取支持的特征                            |
| [slot]setExposureMode(mode: QCamera.ExposureMode)         | None                     | 设置曝光模式                              |
| isExposureModeSupported(mode: QCamera.ExposureMode)       | bool                     | 获取是否支持某种曝光模式                  |
| [slot]setAutoExposureTime()                               | None                     | 打开自动计算曝光时间                      |
| exposureTime()                                            | float                    | 获取曝光时间                              |
| [slot]setManualExposureTime(float)                        | None                     | 设置曝光时间(秒)                          |
| manualExposureTime()                                      | float                    | 获取自定义曝光时间                        |
| [slot]setAutoIsoSensitivity()                             | None                     | 根据曝光值开启自动选择光敏感值            |
| isoSensitivity()                                          | int                      | 获取光敏感值                              |
| [slot]setManualIsoSensitivity(iso: int)                   | None                     | 设置自定义光敏感值                        |
| manualIsoSensitivity()                                    | int                      | 获取自定义的光敏感值                      |
| [slot]setExposureCompensation(ev: float)                  | None                     | 设置曝光补偿(EV值)                        |
| exposureCompensation()                                    | float                    | 获取曝光补偿                              |
| I slot]setFlashMode(QCamera.FlashMode)                    | None                     | 设置快闪模式                              |
| flashMode()                                               | QCamera.FlashMode        | 获取快闪模式                              |
| isFlashModeSupported(mode: QCamera.FlashMode)             | bool                     | 获取是否支持某种快闪模式                  |
| isFlashReady()                                            | bool                     | 获取是否可以用快闪                        |
| setFocusMode(QCamera.FocusMode)                           | None                     | 设置对焦模式                              |
| focusMode()                                               | QCamera.FocusMode        | 获取对焦模式                              |
| isFocusModeSupported(mode: QCamera.FocusMode)             | bo01                     | 获取是否支持某种焦点模式                  |
| setFocusDistance(d: float)                                | None                     | 设置自定义焦距,0表示最近的点,1 表示无限远 |
| focusDistance()                                           | float                    | 获取自定义焦距                            |
| setCustomFocusPoint(point: Union[QPointF,QPoint])         | None                     | 设置自定义焦点位置                        |
| customFocusPoint()                                        | QPointF                  | 获取自定义焦点                            |
| focusPoint()                                              | QPointF                  | 获取焦点                                  |
| [slot]setTorchMode(QCamera.TorchMode)                     | None                     | 设置辅助光源模式                          |
| torchMode()                                               | QCamera.TorchMode        | 获取辅助光源模式                          |
| isTorchModeSupported(mode: QCamera.TorehMode)             | boul                     | 获取是否支持某种辅助光源模式              |
| [slot]setWhiteBalanceMode(mode: QCamera.WhiteBalanceMode) | None                     | 设置白平衡模式                            |
| isWhiteBalanceModeSupported(QCamera.WhiteBalanceMode)     | bool                     | 获取是否支持某种白平衡模式                |
| whiteBalanceMode()                                        | QCamera.WhiteBalanceMole | 获取白平衡模式                            |
| [slot]setColorTemperature(int)                            | None                     | 设置颜色温度(K温度)                       |
| colorTemperature()                                        | int                      | 获取颜色温度                              |
| setZoomFactor(factor:float)                               | None                     | 设置缩放系数                              |
| zoomFactor()                                              | float                    | 获取缩放系数                              |
| [slot]zoomTo(zoom:float, rate: float)                     | None                     | 根据速率设置缩放系数                      |
| maximumExposureTime()                                     | float                    | 获取最大的曝光时间                        |
| minimumExposureTime()                                     | float                    | 获取最小的曝光时间                        |
| maximumIsoSensitivity()                                   | int                      | 获取最大的光敏感值                        |
| minimumIsoSensitivity()                                   | int                      | 获取最小的光敏感值                        |
| maximumZoomFactor()                                       | float                    | 获取最大的放大系数                        |
| minimumZoomFactor()                                       | float                    | 获取最小的放大系数                        |
| errorString()                                             | str                      | 获取出错信息                              |
| error()                                                   | QCamera.Error            | 获取出错类型                              |

- 用setCameraDevice(cameraDevice:QCameraDevice)方法为视频接口设置视频设备;

- 用start()方法或 setActive(true)方法开启视频设备;用stop()方法或setActive(false)方法停止视频设备。

- 用supportedFeatures()方法获取相机支持的特征,返回值如表所示:

  | 相机的特征值                         | 值   | 说 明                  |
  | ------------------------------------ | ---- | ---------------------- |
  | QCamera.Feature.ColorTemperature     | 0x1  | 相机支持色温           |
  | QCamera.Feature.ExposureCompensation | 0x2  | 相机支持曝光补偿       |
  | QCamera.Feature.IsoSensitivity       | 0x4  | 相机支持自定义光般感值 |
  | QCamera.Feature.ManualExposureTime   | 0x8  | 相机支持自定义曝光时间 |
  | QCamera.Feature,CustomFocusPoint     | 0x10 | 相机支持自定义焦点     |
  | QCamera.Feature.FocusDistance        | 0x20 | 相机支持自定义焦距     |



- 用setExposureMode(mode;QCamera.ExposureMode)方法设置相机的曝光模式参数 mode 的取值是 QCamera.ExposureMode 的枚举值,可取的值如表所示;

  | QCamera.ExposureMode的枚举值 | 值   | 模式 | QCamera.ExposureMode的枚举值  | 值   | 模式 |
  | ---------------------------- | ---- | ---- | ----------------------------- | ---- | ---- |
  | QCamera.ExposureAuto         | 0    | 自动 | QCamera.ExposureNightPortrait | 9    | 夜晚 |
  | QCamera.ExposureManual       | 1    | 手动 | QCamera.ExposureTheatre       | 10   | 剧院 |
  | QCamera.ExposurePortrait     | 2    | 人物 | QCamera.ExposureSunset        | 11   | 傍晚 |
  | QCamera.ExposureNight        | 3    | 夜晚 | QCamera.ExposureSteadyPhoto   | 12   | 固定 |
  | QCamera.ExposureSports       | 4    | 运动 | QCamera.ExposureFireworks     | 13   | 火景 |
  | QCamera.ExposureSnow         | 5    | 雪景 | QCamera.ExposureParty         | 14   | 宴会 |
  | QCamera.ExposureBeach        | 6    | 海景 | QCamera.ExposureCandlelight   | 15   | 烛光 |
  | QCamera.ExposureAction       | 7    | 动作 | QCamera.ExposureBarcode       | 16   | 条码 |
  | QCamera.ExposureLandscape    | 8    | 风景 |                               |      |      |

  - 用isExposureModeSupported(mode:QCamera,ExposureMode)方法获取是否支持某种曝光模式。

- 用setFlashMode(mode:QCameraFlashMode)方法设置相机的快闪模式,参数mode的取值是QCamera,FlashMode 的枚举值,可取:

  > - QCamera.FlashOff
  > - QCamera.FlashOn 
  > - QCamera.FlashAuto;

  - 用isFlashModeSupported(mode:QCamera.FlashMode)方法获取是否支持某种快闪模式。

- 用setFocusMode(mode;QCamera,FocusMode)方法设置对焦模式,参数 mode的取值是QCamera.FocusMode 的枚举值,可取的值如表所示。

  | QCamera.FocusMode的枚举值   | 值   | 说 明                              |
  | --------------------------- | ---- | ---------------------------------- |
  | QCamera.FocusModeAuto       | 0    | 连续自动对焦模式                   |
  | QCamera.FocusModeAutoNear   | 1    | 对近处物体连续自动对焦模式         |
  | QCamera.FocusModeAutoFar    | 2    | 对远处物体连续自动对焦模式         |
  | QCamera.FocusModeHyperfocal | 3    | 对超过焦距范围的物体采用最大景深值 |
  | QCamera.FocusModeInfinity   | 4    | 对无限远对焦模式                   |
  | QCamera.FocusModeManual     | 5    | 手动或固定对焦模式                 |

- 用setTorchMode(mode:QCameraTorchMode)方法设置辅助光源模式,在光线不强时可以设置该模式,并会覆盖快闪模式,参数 mode可取值为 QCamera.TorchOffQCamera,TorchOn 或QCamera,TorchAuto。

- 用setWhiteBalanceMode(mode;QCamera.WhiteBalanceMode)方法设置白平衡模式,白平衡是描述红、绿、蓝三基色混合生成后白色精确度的一项指标。

  - 在房间里的日光灯下拍摄的影像会显得发绿
  - 在室内钨丝灯光下拍摄出来的景物会偏黄
  - 而在日光阴影处拍摄到的照片则偏蓝

  白平衡的作用是不管在任何光源下都能将白色物体还原为白色。参数 mode是 QCamera,WhiteBalanceMode 的枚举值可取的值如表所示。

  | QCamera.WhiteBalanceMode的枚举值 | 值   | 模式   | QCamera.WhiteBalanceMode的枚举值 | 值   | 模式 |
  | -------------------------------- | ---- | ------ | -------------------------------- | ---- | ---- |
  | QCamera.WhiteBalanceAuto         | 0    | 自动   | QCamera.WhiteBalanceSunlight     | 2    | 阳光 |
  | QCamera.WhiteBalanceManual       | 1    | 手动   | QCamera.WhiteBalanceCloudy       | 3    | 云   |
  | QCamera.WhiteBalanceShade        | 4    | 阴影   | QCamera.WhiteBalanceFlash        | 7    | 快闪 |
  | QCamera.WhiteBalanceTungsten     | 5    | 鸨灯   | QCamera.WhiteBalanceSunset       | 8    | 日落 |
  | QCamera.WhiteBalanceFluorescent  | 6    | 荧光灯 |                                  |      |      |

  

  - 在手动模式下,需要用setColorTemperature(colorTemperature:int)方法设置色温

- 用errorString()方法取可读的出错信息,用error()方法取出错类型返回值为QCamera.NoError 或QCamera, CameraError。

###### 视频接口 QCamera的信号

视频接口QCamera 的信号如表所示。

| QCanera的信号及参数类型                             | 说明                             |
| --------------------------------------------------- | -------------------------------- |
| activeChanged(bool)                                 | 照相机启动或停止时发送信号       |
| cameraDeviceChanged()                               | 照相设备发生改变时发送信号       |
| cameraFormatChanged()                               | 格式发生改变时发送信号           |
| colorTemperatureChanged()                           | 色温发生改变时发送信号           |
| customFocusPointChanged()                           | 自定义焦点发生改变时发送信号     |
| exposureCompensationChanged(value: float)           | 曝光补偿发生改变时发送信号       |
| exposureModeChanged()                               | 曝光模式发生改变时发送信号       |
| exposureTimeChanged(speed:float)                    | 曝光时间发生改变时发送信号       |
| flashModeChanged()                                  | 快闪模式发生改变时发送信号       |
| flashReady(ready:bool)                              | 可以快闪时发送信号               |
| focusDistanceChanged(float)                         | 焦距发生改变时发送信号           |
| focusPointChanged()                                 | 焦点发生改变时发送信号           |
| isoSensitivityChanged(value:int)                    | 光敏感值发生改变时发送信号       |
| manualExposureTimeChanged(speed:float)              | 自定义曝光时间发生改变时发送信号 |
| manualIsoSensitivityChanged(int)                    | 自定义光敏感值发生改变时发送信号 |
| maximumZoomFactorChanged(float)                     | 最大缩放系数发生改变时发送信号   |
| minimumZoomFactorChanged(float)                     | 最小缩放系数发生改变时发送信号   |
| supportedFeaturesChanged()                          | 所支持的特征发生改变时发送信号   |
| torchModeChanged()                                  | 辅助光源模式发生改变时发送信号   |
| whiteBalanceModeChanged()                           | 白平衡发生改变时发送信号         |
| zoomFactorChanged(float)                            | 缩放系数发生改变时发送信号       |
| errorChanged()                                      | 错误状态发生改变时发送信号       |
| errorOccurred(error:QCamera.Error,errorString: str) | 出现错误时发送信号               |

##### 媒体捕获器 QMediaCaptureSession 

媒体捕获器 QMediaCaptureSession 是音频数据和视频数据的集散地它接收从QAudioInput 和 QCamera 传递过来的音频和视频

- 然后将音频转发给 QAudioOutput 播放音频
- 将视频转发给 QVideoWidegt 或 QGraphicsVideoltem 播放视频
- 将音频和视频转发给 QMdiaRecorder 录制音频和视频,转发给 QImageCapture 实现拍照功能。

用QMediaCaptureSession 创建实例对象的方法如下所示。

```python
from PySide6.QtMultimedia import QMediaCaptureSession

QMediaCaptureSession(parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
```



###### 媒体捕获器QMediaCaptureSession 的常用方法

媒体捕获器QMediaCaptureSession 的常用方法如表所示

- 用setAudioInput(input;QAudioInput)方法和 setCamera(camera:QCamera)方法分别设晋音频输入和视频输入;
- 用setAudioOutput(output;QAudioOutput)方法和 setVideoOutput(output:QObject)方法分别设置音频输出设备和视频输出控件以便播放音频和视频;
- 用setRecorder(recorder: QMediaRecorder)方法设置媒体记录器,以便录制音频和视频;
- 用setImageCapture(imageCapture:QImageCapture)方法设置图像捕获器以便实现拍照功能。

| QMediaCaptureSession的方法及参数类型        | 返回值的类型   | 说明           |
| ------------------------------------------- | -------------- | -------------- |
| setAudioInput(input: QAudioInput)           | None           | 设置音频输入   |
| audioInput()                                | QAudioInput    | 获取音频输人   |
| setAudioOutput(output: QAudioOutput)        | None           | 设置音频输出   |
| audioOutput()                               | QAudioOutput   | 获取音频输出   |
| setCamera(camera:QCamera)                   | None           | 设置视频接口   |
| camera()                                    | QCamera        | 获取视频接口   |
| setImageCapture(imageCapture:QImageCapture) | None           | 设置图像捕获器 |
| imageCapture()                              | QImageCapture  | 获取图像捕获器 |
| setRecorder(recorder:QMediaRecorder)        | None           | 设置媒体记录器 |
| recorder()                                  | QMediaRecorder | 获取媒体记录器 |
| setVideoOutput(output: QObject)             | None           | 设置视频输出   |
| videoOutput()                               | QObject        | 获取视频输出   |
| setVideoSink(sink:QVideoSink)               | None           | 设置视频接收器 |
| videoSink()                                 | QVideoSink     | 获取视频接收器 |

###### 媒体捕获器QMediaCaptureSessio 的信号

媒体捕获器 QMediaCaptureSession 的信号如表所示

| QMediaCaptureSession 的信号 | 说 明                          |
| --------------------------- | ------------------------------ |
| audioInputChanged()         | 当音频输人发生改变时发送信号   |
| audioOutputChanged()        | 当音频输出发生改变时发送信号   |
| cameraChanged()             | 当视频输人发生改变时发送信号   |
| videoOutputChanged()        | 当视频输出发生改变时发送信号   |
| imageCaptureChanged()       | 当图像捕获器发生改变时发送信号 |
| recorderChanged()           | 当记录器发生改变时发送信号     |

###### 媒体捕获器 QMediaCaptureSession 的应用实例

下面的程序用摄像头实时捕捉画面,并呈现捕捉到的画面

```python
# -*- coding: UTF-8 -*-
# File date: Hi_2023/2/28 23:03
# File_name: demo.py

import sys
from PySide6.QtWidgets import QApplication, QWidget, QPushButton, QVBoxLayout, QHBoxLayout
from PySide6.QtMultimedia import QMediaDevices, QCamera, QMediaCaptureSession
from PySide6.QtMultimediaWidgets import QVideoWidget


class MyWindow(QWidget):
    def __init__(self, parent=None):
        super().__init__(parent)

        self.resize(800, 600)
        self.setupUi()

    def setupUi(self):
        self.videoWidget = QVideoWidget()  # 显示视频的控件
        self.btn_start = QPushButton("启动摄像头")  # 打开摄像头按钮
        self.btn_stop = QPushButton("停止摄像头")  # 停止摄像头按钮

        h = QHBoxLayout()  # 按钮水平布局
        h.addWidget(self.btn_start)
        h.addWidget(self.btn_stop)

        v = QVBoxLayout(self)
        v.addWidget(self.videoWidget)
        v.addLayout(h)

        self.mediaDevice = QMediaDevices(self)  # 媒体设备
        self.cameraDevice = self.mediaDevice.defaultVideoInput()  # 获取默认的视频输人设备

        self.camera = QCamera(self.cameraDevice)  # 根据视频输人设备定义视频接口
        self.mediaCaptureSession = QMediaCaptureSession(self)  # 媒体捕获器
        self.mediaCaptureSession.setCamera(self.camera)  # 设置媒体捕获器的视频接口
        self.mediaCaptureSession.setVideoOutput(self.videoWidget)  # 设置捕获器的视频输出控件

        self.btn_start.clicked.connect(self.camera.start)  # 信号与槽连接
        self.btn_stop.clicked.connect(self.camera.stop)  # 信号与槽连接


if __name__ == '__main__':
    app = QApplication(sys.argv)
    win = MyWindow()

    win.show()
    sys.exit(app.exec())

```



##### 媒体格式QMediaFormat

在进行音频和视频的录制时,需要指定音频和视频的记录格式,以及媒体文件的存储格式,这些格式通过QMediaFormat 类来定义。

用QMediaFormat 类创建媒体格式实例的方法如下所示。

```python
from PySide6.QtMultimedia import QMediaFormat

QMediaFormat(format: PySide6.QtMultimedia.QMediaFormat.FileFormat = Instance(PySide6.QtMultimedia.QMediaFormat.FileFormat.UnspecifiedFormat)) -> None
QMediaFormat(other: Union[PySide6.QtMultimedia.QMediaFormat, PySide6.QtMultimedia.QMediaFormat.FileFormat]) -> None
```



**媒体格式 QMediaFormat 的常用方法**

主要方法介绍如下

- 分别用setFileFormat(f;QMediaFormat, FileFormat)方法setAudioCodec(codec:QMediaFormat;AudioCodec)方法和 setVideoCodec(codec: QMediaFormat.VideoCodec)方法设置保存媒体的文件格式音频编码格式和视频编码格式

  - 可选的文件格式、音频编码格式和视频编码格式如表所示。

    | 文件格式                | 音频编码格式                        | 视频编码格式                        |
    | ----------------------- | ----------------------------------- | ----------------------------------- |
    | QMediaFormat.WMA        | QMediaFormat.AudioCodec.WMA         | QMediaFormat.VideoCodec.VP8         |
    | QMediaFormat.AAC        | QMediaFormat.AudioCodec.AC3         | QMediaFormat.VideoCodec.MPEG2       |
    | QMediaFornat.Matroska   | QMediaFormat.AudioCodec.AAC         | QMediaFormat.VideoCodec.MPEG1       |
    | QMediaFormat.WMV        | QMediaFormat.AudioCodec.ALAC        | QMediaFormat.VideoCodec.WMV         |
    | QMediaFormat.MP3        | QMediaFormat.AudioCodec.DolbyTrueHD | QMediaFormat.VideoCodec.H265        |
    | QMediaFormat.Wave       | QMediaFormat.AudioCodec.EAC3        | QMediaFormat.VideoCodec.H264        |
    | QMediaFormat.Ogg        | QMediaFormat.AudioCodec.MP3         | QMediaFormat.VideoCodec.MPEG4       |
    | QMediaFormat.MPEG4      | QMediaFormat.AudioCodec.Wave        | QMediaFormat.VideoCodec.AV1         |
    | QMediaFormat.AVI        | QMediaFormat.AudioCodec.Vorbis      | QMediaFormat.VideoCodec.MotionJPEG  |
    | QMediaFormat.QuickTime  | QMediaFormat.AudioCodec.FLAC        | QMediaFormat.VideoCodec.VP9         |
    | QMediaFormat.WebM       | QMediaFormat.AudioCodec.Opus        | QMediaFormat.VideoCodec.Theora      |
    | QMediaFormat.Mpeg4Audio | QMediaFormat.AudioCodec.Unspecified | QMediaFormat.VideoCodec.Unspecified |
    | QMediaFormat.FLAC       |                                     |                                     |

- 支持编码格式获取

  - supportedFileFormats(QMediaFormat, ConversionMode) 获取编码或解码时支持的文件格式列表
  - supportedAudioCodecs(QMediaFormat.ConversionMode) 获取编码或解码时支持的频编码格式列表
  - supportedVideoCodecs(QMediaFormatConversionMode) 获取编码或解码时支持的视频编码格式列表

  参数 QMediaFormat ConyersionMode可取

  - QMediaFormat.Encode
  - QMediaFormat.Decode



| QMediaFormat的方法及参数类型                           | 返回值的类型                  | 说明                              |
| ------------------------------------------------------ | ----------------------------- | --------------------------------- |
| setFileFormat(f: QMediaFormat.FileFormat)              | None                          | 设置文件格式                      |
| fileFormat()                                           | QMediaFormat.FileFormat       | 获取文件格式                      |
| setAudioCodec(codec: QMediaFormat.AudioCodec)          | None                          | 设置音频编码格式                  |
| audioCodec()                                           | QMediaFormat.AudioCodec       | 获取音频编码格式                  |
| setVideoCodec(codec:QMediaFormat.VideoCodec)           | None                          | 设置视频编码格式                  |
| videoCodec()                                           | QMediaFormat.VideoCodec       | 获取视频编码格式                  |
| supportedFileFormats(QMediaFormat.ConversionMode)      | List[QMediaFormat.FileFormat] | 获取支持的文件格式 列表           |
| supportedAudioCodecs(QMediaFormat.ConversionMode)      | List[QMediaFormat.AudioCodec] | 获取支持的音频编码格 式列表       |
| supportedVideoCodecs(QMediaFormat.ConversionMode)      | List[QMediaFormat.VideoCodec] | 获取支持的视频编码格 式列表       |
| isSupported(mode: QMediaFormat.ConversionMode)         | bool                          | 获取是否可以对某种格 式编码或解码 |
| [static]fileFormatDescription(QMediaFormat.FileFormat) | str                           | 获取文件格式信息                  |
| [static]fileFormatName(QMediaFormat.FileFormat)        | str                           | 获取文件格式名称                  |
| [static]audioCodecDescription(QMediaFormat.AudioCodec) | str                           | 获取音频格式信息                  |
| [static]audioCodecName(QMediaFormat.AudioCodec)        | str                           | 获取音频格式名称                  |
| [static]videoCodecDescription(QMediaFormat.VideoCodec) | str                           | 获取视频格式信息                  |
| [static]videoCodecName(QMediaFormat.VideoCodec)        | str                           | 获取视频格式名称                  |

##### 媒体录制QMediaRecorder

QMediaRecorder 可以录制从 QMediaCaptureSession 获取的音频和视频,并对音频和视频进行编码,需要用QMediaCaptureSession 的 setRecorder(recorder:QMediaRecorder)方法设置关联的捕获器。

用QMediaRecorder创建实例的方法如下所示

```python
from PySide6.QtMultimedia import QMediaRecorder

QMediaRecorder(self, parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
```

###### 媒体录制 QMediaRecorder 的常用方法

QMediaRecorder 的常用方法如表所示,主要方法介绍如下

- 当 QMediaRecorder 准备就绪可以录制时isAvailable()的返回值是 True;

- 用record()方法开始录制,用stop()方法停止录制,用pause()方法暂停录制,

- 用duration()方法获取录制的时间,单位是毫秒。

- 用recorderState()方法获取录制状态,返回值是QMediaRecorder.RecorderState 的枚举值,可取:

  - QMediaRecorder,StoppedState
  - QMediaRecorder.RecordingState
  - QMediaRecorder.PausedState

- 录制过程中如果出错可以用error()方法获取出错内容,返回值是QMediaRecorder.Error 的枚举值,可取以下值,用errorString()方法获取具体的出错信息。:

  > - QMediaRecorder.NoError
  > - QMediaRecorder.ResourceError(设备没有准备好)
  > - QMediaRecorder,ForatError(不支持该格式)
  > - QMediaRecorder.OutOfSpaceError(存储空间不足)
  > - QMediaRecorder.LocationNotWritable(输出位置不可写)

- 用setEncodingMode(QMediaRecorder.EncodingMode)方法设置编码模式,参数是QMediaRecorder, EncodingMode 的枚举值可取:

  - QMediaRecorder.ConstantQualityEncoding(常质量编码)
  - QMediaRecorder ConstantBitRateEncoding(常比特率编码)
  - QMediaRecorder,AverageBitRateEncoding(平均比特率编码)
  - QMediaRecorderTwoPassEncoding(二次编码)

- 用setQuality(quality:QMediaRecorder.Quality)方法设置录制质量,参数是QMediaRecorder.Quality 的举值,可取:

  - QMediaRecorder.VeryLowQuality
  - QMediaRecorder.LowQuality
  - QMediaRecorder.NormalQuality
  - QMediaRecorder.HighQuality
  - QMediaRecorder.VeryHighQuality。

- 用setMediaFormat(format: Union[QMediaFormat,QMediaFormat, FileFormat])方法设置媒体格式。

| QMediaRecorder 的方法及参数类型                              | 返回值的类型                 | 说明               |
| ------------------------------------------------------------ | ---------------------------- | ------------------ |
| isAvailable()                                                | bool                         | 获取是否可以录制   |
| [slot]record()                                               | None                         | 开始录制           |
| [slot]stop()                                                 | None                         | 停止录制           |
| [slot]pause()                                                | None                         | 暂停录制           |
| duraticn()                                                   | int                          | 获取录制的时间     |
| error()                                                      | QMediaRecorder.Error         | 获取出错内容       |
| errorString()                                                | str                          | 获取出错信息       |
| recorderState()                                              | QMediaRecorder.RecorderState | 获取录制状态       |
| captureSession()                                             | QMediaCaptureSession         | 获取关联的捕获器   |
| setAudioBitRate(bitRate:int)                                 | None                         | 设置音频比特率     |
| audioBitRate()                                               | int                          | 获取音频比特率     |
| setAudioChannelCount(channels:int)                           | None                         | 设置音频通道数量   |
| audioChannelCount()                                          | int                          | 获取音频通道数量   |
| setAudioSampleRate(sampleRate: int)                          | None                         | 设置音频采样率     |
| audioSampleRate()                                            | int                          | 获取音频采样率     |
| setEncodingMode(QMediaRecorder.EncodingMode)                 | None                         | 设置编码模式       |
| setMediaFormat(Union[QMediaFormat, QMediaFormat.FileFormat]) | None 际最好海谢部含部        | 设置媒体格式       |
| mediaFormat()                                                | QMediaFormat                 | 获取媒体格式       |
| setMetaData(QMediaMetaData)                                  | None                         | 设置媒体元数据     |
| metaData()                                                   | QMediaMetaData               | 获取媒体元数据     |
| addMetaData(QMediaMetaData)                                  | None                         | 添加媒体元数据     |
| setOutputLocation(Union[QUrl,str])                           | None                         | 设置媒体输出位置   |
| outputLocation()                                             | QUrI                         | 获取输出位置       |
| actualLocation()                                             | QUrI                         | 获取实际的输出位置 |
| setQuality(QMediaRecorder.Quality)                           | None                         | 设置录制质量       |
| quality()                                                    | QMediaRecorder.Quality       | 获取录制质量       |
| setVideoBitRate(bitRate:int)                                 | None                         | 设置视频比特率     |
| videoBitRate()                                               | int                          | 获取视频比特率     |
| setVideoFrameRate(frameRate: float)                          | None                         | 设置视频帧速       |
| videoFrameRate()                                             | float                        | 获取视频帧速       |
| setVideoResolution(QSize)                                    | None                         | 设置视频分辨率     |
| setVideoResolution(width: int, height: int)                  | None                         | 设置视频分辨率     |
| videoResolution()                                            | QSize                        | 获取视频分辨率     |

###### 媒体录制QMediaRecorder 的信号

媒体录制QMediaRecorder 的信号如表所示

| QMediaRecorder的信号及参数类型                             | 说明                       |
| ---------------------------------------------------------- | -------------------------- |
| actualLocationChanged(location:QUrl)                       | 存储位置发生改变时发送信号 |
| durationChanged(duration:int)                              | 录制时间发生改变时发送信号 |
| errorChanged()                                             | 错误状态发生改变时发送信号 |
| errorOccurred(error: QMediaRecorder.Error,errorString:str) | 出现错误时发送信号         |
| mediaFormatChanged()                                       | 格式发生改变时发送信号     |
| metaDataChanged()                                          | 元数据发生改变时发送信号   |
| recorderStateChanged(state:QMediaRecorder.RecorderState)   | 录制状态发生改变时发送信号 |

##### 图像捕获QImageCapture 

用媒体捕获器QMediaCaptureSession的 setImageCapture(imageCapture:QImageCapture)方法将 QImageCapture 与 QMediaCatureSession 关联,可以捕获图像,实现拍照功能。

用QImageCapture类定义图像捕的方法如下所示

```python
from PySide6.QtMultimedia import QImageCapture

QImageCapture(parent: Union[PySide6.QtCore.QObject, NoneType]= None) -> None
```



###### 图像捕获 QImageCapture 的常用方法

图像捕获 QImageCapture 的常用方法如表所示,主要方法介绍如下

- 当isReadyForCapture()的返回值是 True 时,可以进行拍照;

- 用capture()方法进行拍照,返回值是拍照的识别号ID

  - 同时会发送imageCaptured(id;int,preview:QImage)信号和 imageExposed(id:int)信号,可以获取拍摄的图像;

- 用captureToFile(location:str=)方法直接将拍摄的图像保存到文件中,

  - 同时发送imageCaptured(id;int,preview; QImage)信号、imageExposed(id;int)信号和imageSaved(id;int,fileName:str)信号
  - 如果没有给出保存的文件名和路径则使用默认的路径和文件名,如果只给出文件名,则保存到默认路径下
  - 完整路径可以通过imageSaved(id:int,fileName:str)信号的参数获取。

- 用error()方法获取拍照时的出错状态返回值是QImageCapture.Error 举值可取以下值,对应值分别是0~5,用errorString()方法获取出错信息。:

  - QImageCapture.NoError
  - QImageCapture.NotReadyError(设备没准备好)
  - QImageCapture.ResourceError(设备没准备好或不可用)
  - QImageCapture.OutOfSpaceError(存储空间不够)
  - QImageCapture,NotSupportedFeatureError(设备不支持拍照)
  - QImageCapture.FormatError(格式出错)

  

- 用setFileFormat(format: QImageCapture,FileFormat)方法设置拍照的格式,参数是QImageCapture,FileFormat 的枚举值,可取:

  - QImageCapture.FileFormat.JPEG
  - QImageCapture.FileFormat.PNG
  - QImageCapture.FileFormat.Tiff
  - QImageCapture.FileFormat.WebP
  - QImageCapture.FileFormat.UnspecifiedFormat 
  - QImageCapture.FileFormat.LastFileFormat

- 用setQuality(quality: QImageCapture.Quality)方法设置图像质量,参数是QImageCapture.Quality 的举值,可取以下值,,=对应值分别是0~4:

  - QImageCapture.VeryLowQuality
  - QImageCapture.LowQuality
  - QImageCapture.NormalQuality
  - QImageCapture.HighQuality
  - QImageCapture.VeryHighQuality

| QImageCapture的方法及参数类型                           | 返回值的类型                   | 说明             |
| ------------------------------------------------------- | ------------------------------ | ---------------- |
| isReadyForCapture()                                     | bool                           | 获取是否可以拍照 |
| [slot]capture()                                         | int                            | 进行拍照         |
| [slot]captureToFile(location:str='')                    | int                            | 拍照到文件中     |
| captureSession()                                        | QMediaCaptureSession           | 获取关联的捕捉器 |
| error()                                                 | QImageCapture.Error            | 获取出错状态     |
| errorString()                                           | str                            | 获取出错信息     |
| setFileFormat(QImageCapture.FileFormat)                 | None                           | 设置文件格式     |
| setMetaData(metaData:QMediaMetaData)                    | None                           | 设置元数据       |
| metaData()                                              | QMediaMetaData                 | 获取元数据       |
| addMetaData(metaData:QMediaMetaData)                    | None                           | 添加元数据       |
| setQuality(quality:QImageCapture.Quality)               | None                           | 设置图像质量     |
| quality()                                               | QImageCapture.Quality          | 获取图像质量     |
| setResolution(QSize)                                    | None                           | 设置分辨率       |
| setResolution(width:int,height:int)                     | None                           |                  |
| resolution()                                            | QSize                          | 获取分辨率       |
| [static]fileFormatDescription(QImageCapture.FileFormat) | Str                            | 获取格式的信息   |
| [static]fileFormatName(QImageCapture.FileFormat)        | str                            | 获取格式的名称   |
| [static]supportedFormats()                              | List[QlmageCapture.FileFormat] | 获取支持的格式   |

###### 图像捕获QImageCapture 的信号

图像捕获 QImageCapture 的信号如表所示

其中imageAvailable(id:int,frame:QVideoFrame)信号的参数 QVideoFrame是视频,利用QVideoFrame 的 toImage()方法可以得到 QImage。

| QImageCapture的信号及参数类型                                | 说 明                      |
| ------------------------------------------------------------ | -------------------------- |
| readyForCaptureChanged(ready:bool)                           | 准备状态发生改变时发送信号 |
| imageCaptured(id: int,preview: QImage)                       | 捕捉到图像时发送信号       |
| imageExposed(id:int)                                         | 图像曝光时发送信号         |
| imageSaved(id: int,fileName: str)                            | 保存图像时发送信号         |
| imageAvailable(id: int,frame: QVideoFrame)                   | 可以获取图像时发送信号     |
| metaDataChanged()                                            | 元数据发生改变时发送信号   |
| qualityChanged()                                             | 图像质量发生改变时发送信号 |
| errorOccurred(id:int,error: QImageCapture.Error,errorString:str) | 出现错误时发送信号         |
| errorChanged()                                               | 错误状态发生改变时发送信号 |
| fileFormatChanged()                                          | 文件格式发生改变时发送信号 |

##### 媒体元数据 QMediaMetaData

用QMediaRecorder或 QImageCapture 的 setMetaData(metaData: QMediaMetaData)方法可以为所录制的音频和视频或拍摄的照片添加媒体元数据,用metaData()方法获取媒体元数据。

###### 媒体元数据 QMediaMetaData 的常用方法

- 需要通过字典形式来定义媒体元数据的值,已经定义的字典关键字可以用keys()方法获取
- 用insert(k:QMediaMetaData.Key,value:Any)方法定义关键字的值。

| QMediaMetaData的方法及参数类型                     | 返回值的类型 | 说 明                |
| -------------------------------------------------- | ------------ | -------------------- |
| insert(k: QMediaMetaData.Key,value:Any)            | None         | 插人关键字及值       |
| keys()                                             | List         | 获取关键字列表       |
| remove(k:QMediaMetaData.Key)                       | None         | 移除关键字           |
| isEmpty()                                          | bool         | 获取是否为空         |
| clear()                                            | None         | 清空所有关键字       |
| stringValue(k:QMediaMetaData.Key)                  | str          | 获取关键字对应的文本 |
| value(k:QMediaMetaData.Key)                        | Any          | 获取关键字对应的值   |
| [static]metaDataKeyToString(k: QMediaMetaData.Key) | str          | 获取关键字对应的文本 |



###### 媒体元数据QMediaMetaData的可选关键字

| 关键字      | 值的类型         | 关键字         | 值的类型                | 关键字             | 值的类型  |
| ----------- | ---------------- | -------------- | ----------------------- | ------------------ | --------- |
| Title       | str              | Url            | Qurl                    | AlbumTitle         | Str       |
| Author      | List[str]        | MediaType      | str                     | AlbumArtist        | Str       |
| Comment     | Str              | FileFormat     | QMediaFormat.FileFormat | ContributingArtist | List[str] |
| Description | Str              | AudioCodec     | QMediaFormat.AudioCodec | TrackNumber        | int       |
| Genre       | List[str]        | VideoCodec     | QMediaFormat.VideoCodec | Composer           | List[str] |
| Date        | QDate            | Duration       | int                     | LeadPerformer      | List[str] |
| Language    | QLocale.Language | AudioBitRate   | int                     | ThumbnailImage     | QImage    |
| Publisher   | str              | VideoFrameRate | float                   | CoverArtImage      | QImage    |
| Copyright   | str              | VideoBitRate\| | int                     | Resolution         | QSize     |

