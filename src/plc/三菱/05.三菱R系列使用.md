---
title: 05.三菱R系列使用
order: 50
---

##   1.新建工程

### 修复FB显示异常的问题

![image-20250219111447216](./img/image-20250219111447216.png)

### 新建项目

新建项目

![image-20250217172919905](./img/image-20250217172919905.png)

![image-20250217172942326](./img/image-20250217172942326.png)

添加主机板，移到CPU到基板上，再添加电源，CPU扩展模块，输入模块，输出模块。

![image-20250217173105416](./img/image-20250217173105416.png)

右键检测电源容量与系统配置。

![image-20250217173314415](./img/image-20250217173314415.png)

![image-20250217173132906](./img/image-20250217173132906.png)

检测完成，无错误说明电源可以供应所有负载使用。系统无错误。模块添加完成。

![image-20250217173413076](./img/image-20250217173413076-1739784854236-1.png)

确定已添加的各个参数。将配置保存到项目。

![image-20250217173637787](./img/image-20250217173637787.png)

可以模拟测试启动PLC。

### 链接实体PLC

![image-20250218113530764](./img/image-20250218113530764.png)

设置通过网线连接PLC读取在线配置

![image-20250218133429366](./img/image-20250218133429366.png)

当与实际PLC连接以后可以通过读取系统参数的方式快速获取上述配置。

### 注意1-编程模式

![image-20250217173801415](./img/image-20250217173801415.png)

若想再gxwork3中正常编程，必须使此次处在写入模块。

## 2.R系列锁存功能

1.CPU模块的各个软元件的内容将在下列情况下被清理变为默认值。

- cpu模块的电源OFF->ON时
- 复位时
- 超过允许瞬停的停电时。

进行锁存设置的各个元件的内容即使在上述情况下，也能通过CPU本体的电池保存供电，因此在连续控制中进行数据管理时，即使发生CPU模块电源OFF超过允许时间的停电，也可以保存各数据并继续控制。



要点：

R00CPU、R01CPU、R02CPU在没有电池的情况下，停电时会对锁存设置的各软元件内容进行保存。

通过将无电池选项卡安装至CPU模块，这三个CPU以外的CPU在没有电池的情况下，停电会对进行锁存的各软元件内容进行保持

## 3.远程口令

![image-20250218101806377](./img/image-20250218101806377.png)

对程序设置口令后，打开该程序时必须输入口令才能查看程序内容。

## 4.不同程序的类型

在三菱R系列PLC中，程序执行类型决定了程序何时以及如何被执行。以下是各种执行类型的详细说明：

### 1. **初始执行类型**

初始执行类型（Initial Execution Type）

   - **说明**：初始执行类型的程序在PLC启动或从停止状态切换到运行状态时执行一次。通常用于初始化变量、设置初始状态等。
   - **应用**：适用于需要在系统启动时进行一次性的初始化操作。

### 2. **扫描执行类型**

扫描执行类型（Scan Execution Type）

   - **说明**：扫描执行类型的程序在每个扫描周期内都会执行一次。这是最常见的执行类型，适用于需要持续监控和控制的逻辑。
   - **应用**：适用于大多数常规控制逻辑，如顺序控制、逻辑判断等。

### 3. **恒定周期执行类型**

恒定周期执行类型（Constant Cycle Execution Type）

   - **说明**：恒定周期执行类型的程序按照设定的固定时间间隔执行，不受扫描周期的影响。适用于需要精确时间控制的场合。
   - **应用**：适用于需要精确时间控制的任务，如定时数据采集、定时输出等。

### 4. **时间执行类型**

时间执行类型（Time Execution Type）

   - **说明**：时间执行类型的程序在指定的时间点执行，可以是每天、每周或每月的特定时间。适用于需要定时执行的任务。
   - **应用**：适用于定时任务，如定时报表生成、定时设备维护等。

### 5. **待机执行类型**

待机执行类型（Standby Execution Type）

   - **说明**：待机执行类型的程序在PLC处于待机状态时执行。待机状态通常是指PLC处于运行状态但没有执行其他任务时。
   - **应用**：适用于需要在系统空闲时执行的任务，如后台数据处理、系统自检等。

### 6. **无执行类型指定**

无执行类型指定（No Execution Type Specified）

   - **说明**：无执行类型指定的程序不会自动执行，需要由其他程序调用或通过外部事件触发。适用于需要手动或条件触发的任务。
   - **应用**：适用于需要通过特定条件或外部事件触发的任务，如手动操作、事件响应等。

### 总结
三菱R系列PLC提供了多种程序执行类型，包括初始、扫描、恒定周期、时间、待机和无执行类型指定。用户可以根据具体需求选择合适的执行类型，以实现不同的控制逻辑和任务调度。

### 程序执行顺序

![image-20250218104724083](./img/image-20250218104724083.png)



### 初始

是CPU模块RUn的状态时，只执行一次。

### 扫描

会根据程序编写的步数，及软元件的导通数量自动计算程序的执行时间。顺序从上往下、从左往右执行，主逻辑程序放在这里

### 恒定周期

是指定时间执行的中断程序，但是与通常的中断程序不同，无需记述中断指针及IRET指令，而是以程序文件为单位执行。

要点：执行恒定周期执行类程序时，需要通过EI指令设置为中断允许状态

![image-20250218102803115](./img/image-20250218102803115.png)

#### 注意

如果恒定周期程序的执行周期小于扫描周期，则该恒定周期程序将不会被执行。



恒定周期程序与中断程序一样，只有在EI到DI之间执行中断时才会被执行。



## 5.标签

### 局部标签的类型

![image-20250218110020386](./img/image-20250218110020386.png)

## 6.运动控制模块

![image-20250218111711581](./img/image-20250218111711581.png)

先添加运动控制模块RD77MS2.

双击![image-20250218111814117](./img/image-20250218111814117.png)

就可以打开运动控制的配置界面

### 1.基本参数设置



![image-20250218134223793](./img/image-20250218134223793.png)

![image-20250218134402088](./img/image-20250218134402088.png)

![image-20250218134438047](./img/image-20250218134438047.png)

### 伺服参数设置

![image-20250218134716016](./img/image-20250218134716016.png)

### 参数查看

![image-20250218140930180](./img/image-20250218140930180.png)



![image-20250218140948022](./img/image-20250218140948022.png)

起始XY地址

## 7.模块地址分配

![image-20250218140720762](./img/image-20250218140720762.png)

每个模块都有一个编号，这个编号就是该模块的起始IO地址，比如此次简单运动控制的编号为70，那么其IO起始就是X70开始。

### 简单测试程序

![image-20250218141629236](./img/image-20250218141629236.png)

运行后，此时伺服会显示D01.

## 8.JOG测试

![image-20250218144610719](./img/image-20250218144610719.png)

相关的伺服参数都可以在

![image-20250218144646084](./img/image-20250218144646084.png)

中找到。

### 注意

**先触发速度设置后在触发正反转命令，如果两个命令同时触发可能会导致当前的速度不会在此时的正反转命令中起作用。**

### 加速时间与减速时间

![image-20250218145640065](./img/image-20250218145640065.png)

可以通过pr32，33参数来选择启用了哪一组加减速参数。

下面是选择第二组加减速参数的代码

![image-20250218145944384](./img/image-20250218145944384.png)

### 设置上下限与原点信号

![image-20250218150102794](./img/image-20250218150102794.png)

## 9.伺服回原

![image-20250218155421588](./img/image-20250218155421588.png)

确保此次设置无误

![image-20250218155455413](./img/image-20250218155455413.png)

### 示波器监控回原

![image-20250218155942945](./img/image-20250218155942945.png)

配置

![image-20250218160002222](./img/image-20250218160002222.png)

设置探针

![image-20250218160023683](./img/image-20250218160023683.png)

设置探针采样

![image-20250218160048306](./img/image-20250218160048306.png)

添加探针颜色。

### 不同回原方式

- 0:近点DOG型
- 4:计数型0
- 5:计数型®
- 6:数据设定型
- 7:刻度原点信号检测型



近DOG点在回原中，第一次收到dog信号后会离开dog信号，最终回原

计数型在第一次收到dog信号后不会离开东莞信号

数据设定型：收到回原命令后会把当前位置设置为原点。

## 10.定位

![image-20250218172836350](./img/image-20250218172836350.png)

定位功能是依靠该定位表实现的，表中的数据可以直接在表中设定也可以在代码中直接写相应的寄存器。

![image-20250218173149921](./img/image-20250218173149921.png)



### 单次定位

![image-20250218172717467](./img/image-20250218172717467.png)

想要完成定位的移动，首先要启用轴，并在第一次运行定位时进行一次伺服回原。

### 直接单次运行 表中2号定位数据

![image-20250218173725789](./img/image-20250218173725789.png)

### 连续运行

![image-20250218180355199](./img/image-20250218180355199.png)

要连续运行直接把要开始运行的编号写入到轴启动号即可。

### 运行模式

运行模式有三种模式：

- 结束
- 连续
- 轨迹

结束是指执行定位后直接结束不进行其他操作

轨迹与连续在执行完成之后会继续执行下一条表的定位数据，直至执行到一条运行模式是结束的数据位置。

连续是指当前定位结束后轴速度会减至0，在执行下一条数据是重新加速。轨迹是指执行当前数据后，不减速直接加速至下一条数据的速度。

## 11.modbus通信

### 接线



![image-20250219124857900](./img/image-20250219124857900.png)

双线接法是：sda与rda短接再接对象设备的a项，sdb与rdb短接再与对象b项连接。

### plc相关配置

![image-20250219130821394](./img/image-20250219130821394.png)

配置通信模式

首先将plc链接改为串行通信

![image-20250219131541655](./img/image-20250219131541655.png)

![image-20250219131602941](./img/image-20250219131602941.png)

![image-20250219131625939](./img/image-20250219131625939.png)

![image-20250219131646279](./img/image-20250219131646279.png)

![image-20250219131759555](./img/image-20250219131759555.png)

添加协议

![image-20250219131815873](./img/image-20250219131815873.png)

#### 协议编辑

![image-20250219132128411](./img/image-20250219132128411.png)

修改为可以编辑协议，可以删除多余的配置

![image-20250219132211180](./img/image-20250219132211180.png)

![image-20250219132339703](./img/image-20250219132339703.png)

![image-20250219132421320](./img/image-20250219132421320.png)

![image-20250219140627058](./img/image-20250219140627058.png)



#### 代码中控制变频器

![image-20250219140946417](./img/image-20250219140946417.png)

plc写的寄存器地址是文档的寄存器地址-40000-1.即如果想控制变频器状态40009.那么就向最开始配置的寄存器地址D6中写入8就行。



G.CPRTCL命令：

![image-20250219155310844](./img/image-20250219155310844.png)

![image-20250219134846103](./img/image-20250219134846103.png)

![image-20250219154649882](./img/image-20250219154649882.png)

参数(U)是485通信的元件编号故写入U3

参数(n1)是485元件的通过值，我们使用的485设置有两个通道；通道1是232通信，通道2是422和485通信。故写2

参数(n2)是连续执行的协议数量，此次使用了两个协议，协议1是与变频器通信的协议，协议2是变频器相关协议。故此次数据为2

参数(S)是起始地址站一个字，我使用了d200作为起始地址，故写入d200.起始地址被占位后，后续从d202开始写入协议编号，要使用协议1与协议2，故把1与2写入到d202与d203中

参数(D)完成扫描为，所以使用M10接受结果。



### 变频器PR相关参数信息



配置PLC端通信参数。

![image-20250219130947282](./img/image-20250219130947282.png)

设置pr340为10，pr79为2网络运行模式

![image-20250219131042190](./img/image-20250219131042190-1739941842982-1.png)

设置modbus通信规格参数

#### 变频器控制代码

![image-20250219155542105](./img/image-20250219155542105.png)

![image-20250219155600859](./img/image-20250219155600859.png)

![image-20250219155622683](./img/image-20250219155622683.png)

![image-20250219155637176](./img/image-20250219155637176.png)



### 编码器数据读取

#### 添加相关modbus数据

![image-20250219145837792](./img/image-20250219145837792.png)

![image-20250219145846936](./img/image-20250219145846936.png)

![image-20250219145858254](./img/image-20250219145858254.png)

将配置写入PLC后

编写相关代码

![image-20250219152203955](./img/image-20250219152203955.png)

![image-20250219152220279](./img/image-20250219152220279.png)

