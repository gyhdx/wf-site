---
title: 01.海康相机介绍
order: 0
---

> https://pinfo.hikrobotics.com/hkws/unzip/20231101163730_26101_doc/
>
> 海康官方文档

#  海康相机

海康面阵相机命名规则

![image-20250220101547687](./img/image-20250220101547687.png)

线阵相机命名规则

![image-20250220101637915](./img/image-20250220101637915.png)

## 1.相机数据接口

### 1.Gige Vision（网口）

-  接口：RJ45网口，
- 速度：千兆1GB（100M/s），万兆10GB（1000m/s）
- 传送距离：图像在无损情况下最长可以传输100m
- 优点：几乎所有PC硬件标准接口，传送距离长，支持POE（网线供电）
- 局限：CPU影响网络数据传送稳定性，CPU越大传送越不稳定。

### 2.USB3.0

- 速度：理想5G（640m/s）实际速率350m/s
- 传输距离：无损情况下，最长8m
- USB3.0是标准接口，使用一根电缆解决方案（通过USB3.0电缆供电）
- 缺点：传输距离短

Gameralink

CXP6/12

以下是关于 **Camera Link** 和 **CoaXPress (CXP-6/12)** 接口的速度、传输距离、优点及局限的详细介绍：

### 3. **Camera Link 接口**

速度

- **最大传输速率**：Camera Link 支持多种配置，其传输速率分别为：
  - **Base 模式**：2.04 Gbps
  - **Medium 模式**：4.08 Gbps
  - **Full 模式**：5.44 Gbps
  - **Full+ 模式**：6.4 Gbps。

传输距离

- **电缆长度**：通常支持 **7 米** 的传输距离，适合短距离、高带宽的应用场景。

优点

1. **高速传输**：适合高分辨率、高帧率的图像传输，满足实时性要求高的应用。
2. **低延迟**：采用点对点连接，延迟极低（通常小于 75 纳秒），适合需要精确同步的应用。
3. **抗干扰能力强**：使用差分信号传输技术，有效抵抗电磁干扰。
4. **接口标准化**：支持多种配置（Base、Medium、Full），灵活适应不同需求。

局限

1. **传输距离有限**：最长仅支持 7 米，不适合长距离传输。
2. **成本较高**：需要专用的图像采集卡和电缆，系统搭建成本较高。
3. **复杂性**：配置和安装相对复杂，需要额外的软件支持。

### 4. **CoaXPress (CXP-6/12) 接口**

速度

- **单通道速率**：
  - **CXP-6**：6.25 Gbps
  - **CXP-12**：12.5 Gbps
- **多通道速率**：通过多通道并联（如 4 通道），CXP-12 可提供高达 **50 Gbps** 的总带宽。

传输距离

- **电缆长度**：
  - **CXP-6**：支持最长 **40 米** 的传输距离。
  - **CXP-12**：支持最长 **35 米** 的传输距离。

优点

1. **高带宽**：适合超高分辨率、高速成像应用，如工业检测和科学研究。
2. **长距离传输**：相比 Camera Link，支持更长的传输距离（最高 40 米）。
3. **一体化设计**：通过单根同轴电缆传输数据、控制信号和电源（PoCXP），简化系统架构。
4. **低延迟和抖动**：触发延迟通常小于 5 微秒，抖动仅为几纳秒，适合实时性要求高的应用。
5. **抗干扰能力强**：同轴电缆具有较高的抗电磁干扰能力。

局限

1. **成本较高**：需要专用的 CXP 图像采集卡和电缆，系统成本较高。
2. **复杂性**：多通道配置和安装较为复杂，适合高性能、高预算的应用场景。
3. **电缆长度限制**：虽然支持较长距离，但在高带宽模式下（如 CXP-12），传输距离会缩短

Camera Link 更适合短距离、高实时性要求的场景，而 CoaXPress 则在高带宽、长距离传输方面表现更优，但两者都需要较高的系统成本。

## 2.相机分类

![image-20250220103258664](./img/image-20250220103258664.png)

## 3.二维码识别

相机应用场景：

定位，测量，缺陷，符号（一维码，二维码，OCR），视觉引导

### 二维码定义

![image-20250220103947243](./img/image-20250220103947243-1740019188012-1.png)

主要有定位区、矫正区、信息区和静区（空白区）

二维码分为QR和DM码

QR支持中文字符

DM只支持ASCLL

### 模块介绍

#### 使用本地图像源

![image-20250220130414044](./img/image-20250220130414044.png)

添加本地图像源

![image-20250220130448562](./img/image-20250220130448562-1740027890155-1.png)

添加图片

![image-20250220130607715](./img/image-20250220130607715.png)

添加完成后电机单次运行就可以显示图像了。



#### 添加二维码识别

![image-20250220130819684](./img/image-20250220130819684.png)

形状第一个，会将整个图像都加载进去，第二个可以识别我们自定义图像范围

![image-20250220131106000](./img/image-20250220131106000.png)



![image-20250220131326618](./img/image-20250220131326618.png)

![image-20250220131515030](./img/image-20250220131515030.png)



运行参数QR和DataMatrix表示只支持这两个类型的二维码识别，极性使用任意兼容就可以。边缘类型使用兼容模式即可。

![image-20250220132129534](./img/image-20250220132129534-1740028890313-3.png)

![image-20250220132517013](./img/image-20250220132517013.png)

高级参数

降采样倍数：就是图像分辨率，数组越大识别越快，识别率越低。

码宽范围：是二维码识别范围，如果范围设置小于图像源的范围。就会识别错误。

镜像模式：可以将图像源镜像翻转。用于处理被镜像的图片

OR畸变：采集的图像被折弯时，可以使用该参数修复

应用模式：有普通、专家、急速。使用不同算法进行识别，不同模式识别速度与成功率不同。一般使用普通模式就行。

DM码类型：DataMatrix码有正方形与长方形两种。

#### 使用相机源

选择相机

![image-20250220134341365](./img/image-20250220134341365.png)

使用实时取流来调试图像清晰度。

![image-20250220134412333](./img/image-20250220134412333.png)

![image-20250220134839558](./img/image-20250220134839558.png)

触发模式置on，使用软件触发。

图像参数的像素格式采样Mono 8 灰度模式。

确认后再图像源关联到相机

![image-20250220135014343](./img/image-20250220135014343.png)

配置完成就可以就行测试

![image-20250220135107853](./img/image-20250220135107853.png)

识别成功

## 4.一维码识别

![image-20250220140510681](./img/image-20250220140510681.png)

一维码的结构



一维码与二维码识别模式差距不大，所以只简单记录一下操作记录

### 条码模块调用

![image-20250220141906317](./img/image-20250220141906317.png)

条码检测出错时一般选择修改检测窗口大小与静区宽度可以较好的识别图像。

不过想要提高识别率最好还是使用深度学习模块

![image-20250220142102432](./img/image-20250220142102432.png)

深度学习模块可以识别普通模块识别不到的码。

### 通过相机识别

![image-20250220142712632](./img/image-20250220142712632.png)

## 5.OCR识别

识别流程：图片预处理------字符检测----字符识别---输出结果



两个部分
训川练：获取，提取特征，输入讯息，训练，生成字符库
识别：设置ROI,提取特征，比对，分类器，输出结果

### 手动训练字符库并识别



![image-20250220150134122](./img/image-20250220150134122.png)

继承第二步字符定位识别的目标

![image-20250220145905461](./img/image-20250220145905461.png)

训练字符库

![image-20250220150010227](./img/image-20250220150010227.png)

手动标记

![image-20250220150057481](./img/image-20250220150057481.png)

增强训练结果

![image-20250220150233791](./img/image-20250220150233791.png)

就可以识别训练过的字符

### 使用深度学习库识别

![image-20250220150439764](./img/image-20250220150439764.png)

### 通过相机拉流来识别

修改相机识别为2k提高帧率

![image-20250220150730542](./img/image-20250220150730542.png)

## 6.模板匹配

mono8照片模式：即灰度照片

优点：分辨率高（精度高），准确度高

灰度0-255每一个像素用8bit存储光亮的强度即2^8=256



模板匹配：

两种方式：

1.基于灰度值

2.基于轮廓点

模板工作流程

![image-20250220153216536](./img/image-20250220153216536.png)

### 基于灰度值

**灰度匹配**模块的特征匹配基于目标在图像中的灰度值分布。

#### 算法工作流

基于灰度值的模板匹配的算法工作流与基于边缘点的基本相同。简言之，即计算模板图像所有可能的旋转平移结果与待匹配图像的相似性，取相似度分数达到阈值且最高的n个结果作为输出。

不同之处在于两者提取的特征。基于灰度值时，以模板图像和待匹配图像的灰度值分布作为特征，使用“归一化互相关性”（Normalized Cross Correlation，NCC）来评价两者灰度值分布的相似性。

#### 算法公式

![img](./img/GUID-7822E8A9-EA95-4BCE-9F6D-63725F074848-high.png)

*图 4 算法公式（基于边缘点）

- r 和c：分别代表模板图像的平移量，等同于上文[基于轮廓点](https://pinfo.hikrobotics.com/hkws/unzip/20231101163730_26101_doc/GUID-3EEB6D91-78DA-40BF-AC7B-537FEBB00FFC.html#GUID-A76E24C6-B373-4DD4-96CE-F057C4030D85__GUID-8DAD3D70-645C-4628-B911-59BB8BAD2ABE)中的x和y
- t：模板图像
- i：待匹配图像
- mt：mi(r, c)：模板图像的灰度均值
- mi(r, c)：待匹配图像特定区域的灰度均值
- s2t：模板图像的灰度值方差
- s2i（r, c）：待匹配图像在特定区域的灰度值方差

如果当前模板图像和待匹配图像某个局部的灰度值线性正相关（两者灰度分布的趋势相同，仅存在整体上的数值偏移或者存在某种比例关系)，则NCC值为1；

如果线性无关，则NCC值为0；

如果线性负相关，则NCC值为-1。

#### 匹配加速机制

基于灰度值的模板匹配也同样借助图像金字塔加速匹配过程，同样具有两个与图像金字塔相关的参数—**金字塔层数**和**匹配结束层**，但参数定义有所差异。**金字塔层数**：相当于上文“基于轮廓点的匹配算法”的匹配加速机制中的**速度尺度**。可在配置灰度模板时配置该参数，具体定义参见下文特征/灰度模板中提及的[金字塔层数](https://pinfo.hikrobotics.com/hkws/unzip/20231101163730_26101_doc/GUID-3EEB6D91-78DA-40BF-AC7B-537FEBB00FFC.html#GUID-C8E062E2-EBDC-4EF3-9647-E499A4E9CB14__GUID-2E9F8713-8F6A-4C12-909A-D385A0969E9F)。**匹配结束层**：相当于上文“基于轮廓点的匹配算法”的匹配加速机制中的**特征尺度**。可在**灰度匹配**模块的**运行参数**页签配置该参数，具体定义参见下文灰度匹配中提及的[匹配结束层](https://pinfo.hikrobotics.com/hkws/unzip/20231101163730_26101_doc/GUID-3EEB6D91-78DA-40BF-AC7B-537FEBB00FFC.html#GUID-30450AD7-F6BE-4128-B2F0-591880E9156D__GUID-DA3B402E-B163-4177-9994-E2A91872FA57)。



基于轮廓算法

### 优化比对流程---金字塔算法

![image-20250221120737283](./img/image-20250221120737283.png)

向下采样：

基于低通滤波器进行平滑处理，图像抽样就可以得到图像金字塔最上层

对图像处理化后会损失图像精度，但是经过归一化处理后

![image-20250221121228726](./img/image-20250221121228726.png)

图像得出的物体特征值差距不大，使用使用金字塔算法降低图像精度后，图像识别速率会有提升。



### 使用场景与模块选用

| 模块                                                         | 特点                                                         | 适用场景                                                     |
| :----------------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| [灰度匹配](https://pinfo.hikrobotics.com/hkws/unzip/20231101163730_26101_doc/GUID-3EEB6D91-78DA-40BF-AC7B-537FEBB00FFC.html#GUID-30450AD7-F6BE-4128-B2F0-591880E9156D) | 建模时提取物体在图像中的灰度值分布                           | 图像中的待匹配目标无明显且稳定的轮廓点，但灰度值分布相对稳定。例如对比度较低和受随机噪声干扰的场景 |
| [快速匹配](https://pinfo.hikrobotics.com/hkws/unzip/20231101163730_26101_doc/GUID-3EEB6D91-78DA-40BF-AC7B-537FEBB00FFC.html#GUID-1E0B9D61-08B9-4DE8-A2FB-63828E93FF32) | 建模时提取物体的粗糙轮廓，定位精度较低。**对存在形变的目标，匹配效果更好** | 图像中待匹配目标的轮廓点数量较充足且稳定**匹配目标存在一定形变**对定位精度要求不高例如有无判断、方向判断、产品计数等场景 |
| [轮廓匹配](https://pinfo.hikrobotics.com/hkws/unzip/20231101163730_26101_doc/GUID-3EEB6D91-78DA-40BF-AC7B-537FEBB00FFC.html#GUID-57A3CBA5-51C5-40F7-9859-96C40748E2AE) | 建模时提取物体的较精细轮廓，**匹配效率与定位精度均较好**     | 图像中待匹配目标的轮廓点数量较充足且稳定对定位精度和匹配效率要求均较高**说明：****轮廓匹配**可认为是**高精度匹配**的升级版。相比**高精度匹配**和**快速匹配**，**轮廓匹配**兼具匹配效率与定位精度。大部分应用场景下推荐使用**轮廓匹配**。 |
| [高精度匹配](https://pinfo.hikrobotics.com/hkws/unzip/20231101163730_26101_doc/GUID-3EEB6D91-78DA-40BF-AC7B-537FEBB00FFC.html#GUID-11F05391-A171-4F3F-A43C-8A1348B3E02C) | 建模时提取物体的精细轮廓，**定位精度较高，但匹配效率较低**   | 图像中待匹配目标的轮廓点数量充足且稳定对定位精度要求较高但对匹配效率要求不高 |

### 快速匹配

![image-20250221123716884](./img/image-20250221123716884.png)

添加特征模板

参数配置：

#### 特征尺寸

数字越小，采样数据约精确但匹配速断越慢

![image-20250221142920350](./img/image-20250221142920350.png)

![image-20250221142950367](./img/image-20250221142950367.png)

#### 对比度阈值

![image-20250221143306497](./img/image-20250221143306497.png)

指的是特征点与附近点灰度的对比度，越大包含参数越小。

一般这两个参数使用自动配置就好

#### 全部搜索模式

![image-20250221143641857](./img/image-20250221143641857.png)

指的是使用如果开启使用特征模板下所有模板，不开启就只识别第一条模板数据。一般不开启只识别一条模板。	

#### 最小匹配分数

![image-20250221143934816](./img/image-20250221143934816.png)

是一个过滤器，分数低于这个值就识别错误。	

#### 角度范围

![image-20250221144808265](./img/image-20250221144808265.png)

指的是识别出的物体与模板直接偏移的角度。同最小匹配分数一样，也是一个过滤器。

一般使用时

![image-20250221145003733](./img/image-20250221145003733.png)

直接拉满，防止该识别的物体没有被识别到。

#### 尺度范围

指的是模板图片大小与识别图像的大小比例。![image-20250221145201531](./img/image-20250221145201531.png)



#### 最大重叠率

![image-20250221145319984](./img/image-20250221145319984.png)

![image-20250221145303924](./img/image-20250221145303924.png)

指两个物体重叠在一起的比率从0-100.

#### 快速识别测试

![image-20250221150420499](./img/image-20250221150420499.png)

### 高精度匹配

快速匹配只匹配金字塔算法上最上层的图，而轮廓匹配与高精度匹配会匹配金字塔上所有图。

轮廓匹配与高精度匹配的模板参数大致相似，使用此处只使用模板匹配举例

![image-20250221151052297](./img/image-20250221151052297.png)

![image-20250221151108520](./img/image-20250221151108520.png)

高精度匹配的结果比快速匹配得到特征点要多得多。

![image-20250221151224752](./img/image-20250221151224752-1740121945597-11.png)

运行参数与高级参数与快速匹配一致，多了一个尺度范围类型。

![image-20250221151446123](./img/image-20250221151446123.png)

也可以实现

### 灰度匹配

![image-20250221151800741](./img/image-20250221151800741.png)

灰度匹配可以手动设置金字塔层数。角度数据是指识别的角度范围。可以在运行参数处调整。

![image-20250221151927761](./img/image-20250221151927761.png)

灰度匹配的结果是灰度值，所以没有和前几个匹配一样的特征点

![image-20250221152036935](./img/image-20250221152036935.png)

运行参数同上。不具体介绍了

![image-20250221152207802](./img/image-20250221152207802-1740122528586-13.png)

补充只有两个角度都设置才能匹配各类角度图片。

![image-20250221152310001](./img/image-20250221152310001.png)

匹配结果





### 在VM中的编程

![image-20250220162235603](./img/image-20250220162235603.png)

通过位置匹配识别移动数据

![image-20250220162329780](./img/image-20250220162329780.png)

创建识别模板

![image-20250220162409079](./img/image-20250220162409079.png)

再修正位置

![image-20250220162436293](./img/image-20250220162436293.png)

根据上一步的基准点进行位置修正就可以，在物体移动时进行识别。

## 7.Bolb分析

通过**BLOB分析**模块，可在像素为有限灰度级的图像中检测、定位或分析目标物体。该模块可输出目标物体的存在性、数量、位置、形状、方向以及目标物体间的拓扑关系等信息。



举例来说，假如现在有一块刚生产出来的玻璃，表面非常光滑，平整。如果这块玻璃上面没有瑕疵，那么，我们是检测不到灰度突变"的；相反，如果在玻璃生产线上由于种种原因，造成了玻璃上面有一个凸起的小泡、有一块黑斑、有一点裂缝。

bo分析应用案例：纺织品的瑕疵检测，玻璃的瑕疵检测，机械零件表面缺陷检测，可乐瓶缺陷检测，药品胶囊缺陷检测等场合。

blob分析流程

![image-20250221153015895](./img/image-20250221153015895.png)

### 图像二值化

![image-20250221154352512](./img/image-20250221154352512.png)

二值化的图片

![image-20250221155350356](./img/image-20250221155350356.png)

通过阈值方式与极性来控制二值化图像

软阈值：

通过调整阈值柔和度加阶梯值，显示不同层次的灰度（此时就不是二值化了）

### 孔洞填充

![image-20250221155931202](./img/image-20250221155931202.png)

填充面积阈值：这个参数可以控制阈值显示







![image-20250220165039789](./img/image-20250220165039789.png)

## 8.VM与PLC通信

![image-20250221163853001](./img/image-20250221163853001.png)

建立连接

![image-20250221163927838](./img/image-20250221163927838.png)

配置发送数据。然后就可以把数据发出去了。

